#Faster builds
cache: true

language: node_js
node_js:
  - "5.7.0"

build:
  ci:
    - mkdir -p shippable/testresults
    - mkdir -p shippable/codecoverage
    - ssh-agent bash -c 'ssh-add /tmp/ssh/uportdummy; npm install'
    - npm test

after_success:
  - if [ "$BRANCH" == "master" ]; then ssh-agent bash -c 'ssh-add /tmp/ssh/dokkuuportme; git push -f dokku@dokku.uport.me:testapp master' ; fi
  - if [ "$BRANCH" == "develop" ]; then ssh-agent bash -c 'ssh-add /tmp/ssh/dokkuuportme; git push -f dokku@dokku.uport.me:testapp-develop develop:master' ; fi

integrations:
  key:
      - integrationName: dokku.uport.me
        type: ssh-key
      - integrationName: uportdummy
        type: ssh-key
  notifications:
      - integrationName: uport-slack
        type: email
        recipients:
          - "#circle-uport-updates"
        branches:
          only:
            - master
            - develop
        on_start: always
        on_success: change
        on_failure: always
